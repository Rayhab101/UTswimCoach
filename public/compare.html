<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utah Swim Coach - Calendar</title>
    <link rel="stylesheet" href="swim.css">
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous">
        </script>
    <script>
        $(function () {
            $("#header").load("heading.html");
            $("#footer").load("footing.html");
        });
    </script>
    <style>
        .container {
            display: grid;
        }

        .swim_style {
            padding-top: 125px;
        }

        table {
            background-color: white;
            width: 100%;
        }

        td {
            text-align: center;
            height: 22px;
        }

        .t0 {
            grid-row: 1;
            grid-column: 1;
        }

        .t1 {
            grid-row: 1;
            grid-column: 2;
        }

        .t2 {
            grid-row: 1;
            grid-column: 3;
        }

        .t3 {
            grid-row: 1;
            grid-column: 4;
        }

        .t4 {
            grid-row: 1;
            grid-column: 5;
        }
    </style>
    <script>
        function buildPage() {
            var school = location.search.substring(1);
            school = school.split("=");
            school = Number(school[1]);
            fetch("/api/swims/" + school)
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    buildDropdown(myJson, school);
                    buildOtherDropdown(myJson, school);
                })
                .catch(function (error) {
                    console.log("Error: " + error);
                });
        }

        function buildDropdown(people) {
            var ddlSwimmers = document.getElementById("compare");
            // document.getElementById("insert").setAttribute("hidden", true);
            var head = document.createElement("OPTION");
            head.innerHTML = "Select Swimmer";
            ddlSwimmers.options.add(head);
            for (var i = 0; i < people.length; i++) {
                var option = document.createElement("OPTION");
                option.setAttribute("id", i);
                option.innerHTML = people[i].name;
                ddlSwimmers.options.add(option);
            }
        }

        function buildOtherDropdown(people) {
            var ddlSwimmers = document.getElementById("other");
            // document.getElementById("insert").setAttribute("hidden", true);
            var head = document.createElement("OPTION");
            head.innerHTML = "Select Swimmer";
            ddlSwimmers.options.add(head);
            for (var i = 0; i < people.length; i++) {
                var option = document.createElement("OPTION");
                option.setAttribute("id", i);
                option.innerHTML = people[i].name;
                ddlSwimmers.options.add(option);
            }
        }

        function recordPull(id) {
            var relays = [1, 8, 11, 12, 19, 22];
            var body = document.getElementById('individual');
            for (var i = 1; i < 22; i++) {
                if(relays.includes(i)) {
                    continue;
                }
                else if (i < 12) {
                    continue;
                }
                else {
                    fetch('/api/individualRecords/' + id + "&" + i)
                        .then(function (response) {
                            return response.json();
                        }).then(function (records) {
                            console.log(i);
                            var row = document.createElement('tr');
                            var column = document.createElement('td');
                            var cell = row.insertCell();
                            var text;
                            if(records[0].min ==null){
                                text = ""
                            }
                            else{text = records[0].min}
                            text = document.createTextNode(text);
                            console.log(text);
                        }).catch(function (error) {
                            //console.log("Error: " + error);
                        });
                }
            }
        }

        function tableFill(name) {
            fetch("/api/swimmerName/" + name)
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    console.log(myJson[0].swimmer_id)
                    recordPull(myJson[0].swimmer_id)
                    //var gender = myJson.swimmers[id].gender;
                    // var school = myJson.swimmers[id].school;
                    // console.log(gender);
                    // console.log(myJson.swimmers[id].name);
                    // var year = myJson.swimmers[id].year;
                    // document.getElementById("grade").innerHTML = grade;
                    // document.getElementById("year").innerHTML = year;
                })
                .catch(function (error) {
                    console.log("Error: " + error);
                });
        }

        function nameFill() {
            //document.getElementsById("btn").disabled = false;
            var checkOption = document.getElementById("compare");
            var name = checkOption.value;
            var number = document.getElementById("compare").options[checkOption.selectedIndex].id;
            if (name != "Select Swimmer") {
                console.log(name)
                tableFill(name);
            }
        }
        function otherNameFill() {
            //document.getElementsById("btn").disabled = false;
            var checkOption = document.getElementById("other");
            var name = checkOption.value;
            var number = document.getElementById("other").options[checkOption.selectedIndex].id;
            if (name != "Select Swimmer") {
                document.getElementById("name").innerHTML = name;
                tableFill(number);
            }
        }

        function submitTimes(id) {
            fetch("api/swimmers")
                .then(function (response) {
                    return response.json();
                })
                .then(function (myJson) {
                    console.log(id);
                    if (id != "") {
                        for (var i = 0; i < events.length; i++) {
                            var time = document.getElementById(events[i]).value;
                            console.log(myJson.swimmers[id][events[i]]);
                            myJson.swimmers[id][events[i]].push(time);
                        }
                        fetch("api/swimmers", {
                            headers: { 'Content-Type': 'application/json' },
                            method: "POST",
                            body: JSON.stringify(myJson)
                        })
                        // document.getElementById("insert").setAttribute("hidden", true);
                    }
                    // document.getElementById("insert").setAttribute("hidden", true);
                })
                .catch(function (error) {
                    console.log("Error: " + error);
                });
            buildPage();
        }

    </script>
</head>

<body onload="buildPage()">
    <header id="header"></header>
    <main class="swim_style">
        <div class="container">
            <table class="t0">
                <tr>
                    <th>Races:</th>
                </tr>
                <tr>
                    <td></td>
                </tr>
                <tr>
                    <td>200 Freestyle:</td>
                </tr>
                <tr>
                    <td>200 IM:</td>
                </tr>
                <tr>
                    <td>50 Freestyle:</td>
                </tr>
                <tr>
                    <td>100 Butterfly:</td>
                </tr>
                <tr>
                    <td>100 Freestyle:</td>
                </tr>
                <tr>
                    <td>500 Freestyle:</td>
                </tr>
                <tr>
                    <td>100 Backstroke:</td>
                </tr>
                <tr>
                    <td>100 Breaststroke:</td>
                </tr>
            </table>
            <table class="t1" id="indvidual">
                <tr>
                    <th>Name:</th>
                </tr>
                <tr>
                    <td><select id="compare" onchange="nameFill()"></select></td>
                </tr>
            </table>
            <table class="t2">
                <tr>
                    <th>Compare To Other Swimmer:</th>
                </tr>
                <tr>
                    <td><select id="other" onchange="otherNameFill()"></select></td>
                </tr>
            </table>
            <table class="t3">
                <tr>
                    <th>Compare To School Record:</th>
                </tr>
                <tr>
                    <td>School Record</td>
                </tr>
            </table>
            <table class="t4">
                <tr>
                    <th>Compare To State Record</th>
                </tr>
                <tr>
                    <td>State Record</td>
                </tr>
            </table>
        </div>
    </main>
    <footer id="footer"></footer>
</body>

</html>