<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BL/SJ Swim Team- Updates</title>
    <link rel="stylesheet" href="swim.css">
    <script src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous">
        </script>
    <style>
        .swim_info {
            height: 85vh;
            /* padding-top: 65px; */
        }

        table {
            background-color: rgba(255, 255, 255, .95);
            border-collapse: separate;
            border: solid black 1px;
            border-radius: 6px;
            -moz-border-radius: 6px;
            text-align: center;
            width: 100%;
            margin-left: auto;
            margin-right: auto;

        }

        td {
            width: 7.7%;
        }

        input {
            width: 80%;
        }

        .label {
            color: white;
            background-color: rgba(0, 0, 0, .6);
            text-align: center;
        }
    </style>
    <script>
        $(function () {
            $("#header").load("heading.html");
            $("#footer").load("footing.html");
        });

        function buildPage() {
            fetch("/api/meets")
                .then(function (response) {
                    return response.json();
                })
                .then(async function (meets) {
                    var body = document.getElementById("meets");

                    console.log(meets)
                    for (var i = 0; i < meets.length; i++) {
                        var row = document.createElement("tr");
                        row.setAttribute("id", meets[i].meet_id);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createTextNode(column.innerHTML = meets[i].location);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createTextNode(column.innerHTML = meets[i].date);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createTextNode(column.innerHTML = meets[i].time);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        var years = "202" + Number(meets[i].year) - 1 + " - 202" + Number(meets[i].year);
                        text = document.createTextNode(column.innerHTML = years);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createTextNode(column.innerHTML = meets[i].out);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createTextNode(column.innerHTML = meets[i].bus);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createTextNode(column.innerHTML = meets[i].home);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        var schools;
                        if (meets[i].school1 != null) {
                            var school1 = await fetch("/api/schools/" + meets[i].school1).then(data => data.json());
                            schools = school1[0].name;
                            if (meets[i].school2 != null) {
                                var school2 = await fetch("/api/schools/" + meets[i].school2).then(data => data.json());
                                schools += ", " + school2[0].name;
                            }
                        }

                        else {
                            schools = "More than one school";
                        }
                        console.log(schools)

                        text = document.createTextNode(column.innerHTML = schools);
                        cell.appendChild(text);
                        var column = document.createElement("td");
                        var cell = row.insertCell();
                        text = document.createElement("button");
                        text.textContent = "Edit";
                        text.setAttribute("style", "background-color: lime");
                        text.setAttribute("onclick", "alert($(this).closest('tr').attr('id'));");
                        cell.appendChild(text);
                        text = document.createElement("button");
                        text.textContent = "Delete";
                        text.setAttribute("style", "background-color: red");
                        text.setAttribute("onclick", "alert($(this).closest('tr').attr('id'));");
                        cell.appendChild(text);
                        body.appendChild(row);
                    }
                })
                .catch(function (error) {
                    console.log("Error: " + error);
                });
        }
        function addMeet() {
            alert("Not Available Yet")
        }
        // function submitTimes(id) {
        //     fetch("/api/activeSwimmers")
        //         .then(function (response) {
        //             return response.json();
        //         })
        //         .then(function (myJson) {
        //             // console.log(myJson);
        //             for (var i = 0; i < myJson.length; i++) {
        //                 if (myJson[i].swimmer_id == id) {
        //                     // console.table(myJson[i]);
        //                     var gender = myJson[i].gender;
        //                     var school = myJson[i].school;
        //                     var swimYear = myJson[i].year;
        //                 }
        //             }
        //             var swimmer = id;
        //             var checkOption = document.getElementById("ddlMeets");
        //             var meet = document.getElementById("ddlMeets").options[checkOption.selectedIndex].id;
        //             meet = meet.split("_");
        //             meet = meet[1];
        //             var year = new Date().getFullYear();
        //             year = parseInt(year);
        //             if (id != "") {
        //                 for (var i = 0; i < 8; i++) {
        //                     var time = document.getElementById("event_" + i).value;
        //                     if (time != "") {
        //                         if (gender == "F") {
        //                             switch (i) {
        //                                 case 0:
        //                                     var race = "2";
        //                                     break;
        //                                 case 1:
        //                                     var race = "3";
        //                                     break;
        //                                 case 2:
        //                                     var race = "4";
        //                                     break;
        //                                 case 3:
        //                                     var race = "5";
        //                                     break;
        //                                 case 4:
        //                                     var race = "6";
        //                                     break;
        //                                 case 5:
        //                                     var race = "7";
        //                                     break;
        //                                 case 6:
        //                                     var race = "9";
        //                                     break;
        //                                 case 7:
        //                                     var race = "10";
        //                                     break;
        //                                 default:
        //                                     console.log("How did you get here?: ");
        //                                     break;
        //                             }
        //                         }
        //                         if (gender == "M") {
        //                             switch (i) {
        //                                 case 0:
        //                                     var race = "13";
        //                                     break;
        //                                 case 1:
        //                                     var race = "14";
        //                                     break;
        //                                 case 2:
        //                                     var race = "15";
        //                                     break;
        //                                 case 3:
        //                                     var race = "16";
        //                                     break;
        //                                 case 4:
        //                                     var race = "17";
        //                                     break;
        //                                 case 5:
        //                                     var race = "18";
        //                                     break;
        //                                 case 6:
        //                                     var race = "20";
        //                                     break;
        //                                 case 7:
        //                                     var race = "21";
        //                                     break;
        //                                 default:
        //                                     console.log("How did you get here?: ");
        //                                     break;
        //                             }
        //                         }

        //                         // var submitRaces = {swimmer,race,time,school,meet,year,2};
        //                         // console.log(swimmer + "," + race + "," + time+","+","+school+","+meet+","+year);

        //                     }
        //                     var submitRaces = swimmer + "," + race + "," + time + "," + school + "," + meet + "," + year + "," + 2;
        //                     // var submitRaces = { swimmer, race, time, school, meet, year };
        //                     // console.log(JSON.stringify(submitRaces));
        //                     // console.log(submitRaces)
        //                     if (meet != undefined && swimmer != "" && time != "") {
        //                         fetch("/api/setTimes/" + submitRaces, {
        //                             headers: { 'Content-Type': 'application/json' },
        //                             method: "POST",
        //                             // body: JSON.stringify(submitRaces)
        //                         }).then(response => response.json())
        //                             .then(json => console.log(json))
        //                             .catch(err => console.log(err));
        //                     }
        //                     else {
        //                         alert("A needed component was not selected/added");
        //                         break;
        //                     }
        //                 }

        //                 document.getElementById("insert").setAttribute("hidden", true);
        //                 window.location.reload();
        //             }
        //             document.getElementById("insert").setAttribute("hidden", true);
        //             buildPage();

        //         })
        //         .catch(function (error) {
        //             console.log("Error: " + error);
        //         });
        // }
    </script>

</head>
<header id="header"></header>

<body onload="buildPage()">
    <div class="swim_info">
        <h4 class="label">Current Year's Meets</h4>
        <table id="meets">
            <tr>
                <!-- <td><select id="ddlSwimmers" onchange="nameFill()"></select></td> -->
                <td>Location</td>
                <td>Date</td>
                <td>Time</td>
                <td>Swim Season</td>
                <td>Out Time</td>
                <td>Bus Leaving</td>
                <td>Getting Home @</td>
                <td>Schools Participating</td>
                <td rowspan="2"><button onclick="addMeet()">Add
                        Meet</button></td>
            </tr>
        </table>
    </div>

</body>
<footer id="footer"></footer>

</html>